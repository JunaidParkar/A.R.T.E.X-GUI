<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal</title>
    <link rel="stylesheet" href="style2.css">
</head>

<body>
    <div class="app">
        <div class="header">
            <img src="../../assets/appIcons/terminal.png" alt="" class="logo">
            <h3>Terminal</h3>
            <ul>
                <li>command</li>
            </ul>
        </div>

        <div class="commands">

        </div>
    </div>

    <script>

        let commandsEntered = []
        let commandhistory = -1

        function handleKeyPress(event, element) {
            if (event.key === "Enter") {
                element.setAttribute('contenteditable', 'false')

                if (!element.textContent == '') {
                    commandsEntered.push(element.textContent)
                    executeCommand(element.textContent)
                } else {
                    addNewUserCommandBox()
                }

            }

            if (event.key === "ArrowUp" && commandsEntered.length > 0) {
                if (commandhistory == -1) {
                    commandhistory = commandsEntered.length - 1;
                } else if (commandhistory > 0) {
                    commandhistory--;
                }

                element.innerText = commandsEntered[commandhistory];
            }

            if (event.key === "ArrowDown" && commandsEntered.length > 0) {
                if (commandhistory !== commandsEntered.length - 1) {
                    commandhistory++;
                }

                element.innerText = commandsEntered[commandhistory];
            }
        }


        async function executeCommand(command) {
            let predefinedCommands = [
                { command: '--help', type: 'document', callback: () => fetchAndReturn('predefined-commands/--help.txt', 'text') },
                {
                    command: 'clear',
                    type: 'document',
                    callback: () => {
                        setTimeout(() => {
                            document.getElementsByClassName('commands')[0].innerHTML = '';
                            addNewUserCommandBox();
                        }, 50)
                    },
                    predefinedValue: 'Cleared!'
                },
            ];

            let data = "undefined command";

            const matchedCommand = predefinedCommands.find(cmd => cmd.command === command);

            if (matchedCommand && matchedCommand.predefinedValue !== undefined) {
                matchedCommand.callback()
                data = matchedCommand.predefinedValue;
            } else if (matchedCommand) {
                data = await matchedCommand.callback();
            }

            const outputStructure = `
        <div class="computer">
            <p id="output">${data}</p>
        </div>`;

            document.getElementsByClassName('commands')[0].innerHTML += outputStructure;
            addNewUserCommandBox();
        }

        // The rest of your fetchAndReturn function remains the same



        function addNewUserCommandBox() {
            const userCommandStructure = document.createElement('div');
            userCommandStructure.classList.add('user');
            userCommandStructure.innerHTML = `
        <span>artex<big>></big></span>
        <p class="commandInput" contenteditable="true" onkeydown="handleKeyPress(event,this)"></p>`;

            const commandsDiv = document.getElementsByClassName('commands')[0];
            commandsDiv.appendChild(userCommandStructure);

            commandhistory = -1;

            setTimeout(() => {
                const addedCommandInput = commandsDiv.lastElementChild.querySelector('.commandInput');
                addedCommandInput.focus();

                const selection = window.getSelection();
                const range = document.createRange();
                range.setStart(addedCommandInput, 0);
                range.collapse(true);
                selection.removeAllRanges();
                selection.addRange(range);
            }, 50);

            return ''
        }


        addNewUserCommandBox()


        async function fetchAndReturn(url, type = 'json') {
            try {
                const response = await fetch(url);

                if (!response.ok) {
                    return 'Network response was not ok.';
                }
                else if (type == 'text') {
                    const text = await response.text();
                    return text
                } else if (type == 'json') {
                    const json = await response.json()
                    return text
                }

            } catch (error) {
                return error;
            }
        }
    </script>
</body>

</html>